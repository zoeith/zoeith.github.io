<!DOCTYPE html>
<html>
  <head>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-72429926-1', 'auto');
  ga('send', 'pageview');

  </script>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Orientational Bond order	parameter</title>
  <meta name="description" content="Halperin and Nelson,  described a theory of melting in two dimensionsB. I. Halperin and D. R. Nelson, Theory of Two-Dimensional Melting, Phys. Rev. Lett. 41,...">


  <link rel="stylesheet" href="/css/tufte.css">


  <!-- Google Fonts loaded here depending on setting in _data/options.yml true loads font, blank does not-->
  
    <link href='//fonts.googleapis.com/css?family=Lato:400,400italic' rel='stylesheet' type='text/css'>
  
  <!-- Load up MathJax script if needed ... specify in /_data/options.yml file-->
  
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  

  <link rel="canonical" href="http://zoeith.com/articles/16/psi-6-2015-01-11">
  <link rel="alternate" type="application/rss+xml" title="Zoey S. Davidson" href="http://zoeith.com/feed.xml" />
</head>

  <body>
    <!--- Header and nav template site-wide -->
<header>
    <nav class="group">
	<!--- <a href="/"><img class="badge" src="/assets/img/badge_1.png" alt="CH"></a> -->
	
		
		    
		      <a href="/">blog</a>
		    
	    
  	
		
		    
		      <a href="/about/">About</a>
		    
	    
  	
		
  	
	</nav>
</header>

    <article class="group">
      <h1>Orientational Bond order	parameter</h1>
<p class="subtitle">January 14, 2016</p>


<p><span class="newthought">Halperin and Nelson,</span>  described a theory of melting in two dimensions<label for="Halperin-Nelson-cite" class="margin-toggle sidenote-number"></label><input type="checkbox" id="Halperin-Nelson-cite" class="margin-toggle" /><span class="sidenote">B. I. Halperin and D. R. Nelson, <em>Theory of Two-Dimensional Melting</em>, Phys. Rev. Lett. 41, 121 (1978) <cite><a href="http://journals.aps.org/prl/abstract/10.1103/PhysRevLett.41.121">PRL 41, 121</a></cite> </span> in terms of a bond orientational order parameter, <span>​<script type="math/tex"> \psi_6 = \sum_m e^{6i\theta_{m}} </script></span>. As a crystal melts, defects in the crystal lattice appear. At early stages of melting, these defects stay closely assosciated with one another, but at later times and higher temperatures they become plentiful and spread throughout the lattice. The long range orientational order disappears; the lattice dissapears as the matter becomes liquid. They predict in a liquid phase, correlations in orientational (and translational) bond order decay exponentially.<br />
<!--more--><br />
<span class="newthought">This routine begins</span>  by loading open source code into the namespace and defining a helper function to load the neighbors of a particle as determined by a Delaunay triangulation.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="kn">import</span> <span class="n">Delaunay</span>


<span class="k">def</span> <span class="nf">find_neighbors</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">triang</span><span class="p">):</span>
    <span class="s">"""
    Find the neighbors in a delaunay triangulation.
    Works in N-dimensions.
    See docs:
    @scipy.spatial.Delaunay.vertex_neighbor_vertices

    Inputs
    ------
    ix : integer,
        the particle index to look for neighbors of
    triang : the delaunay triangulation object
            returned from the scipy function

    Returns
    -------
    Numpy 1d array of neighboring particle indicies
    in N by dim array used to calculate delaunay
    triangulation object triang.
    """</span>
    <span class="n">nix_1</span> <span class="o">=</span> <span class="n">triang</span><span class="o">.</span><span class="n">vertex_neighbor_vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">ix</span><span class="p">]</span>
    <span class="n">nix_2</span> <span class="o">=</span> <span class="n">triang</span><span class="o">.</span><span class="n">vertex_neighbor_vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">triang</span><span class="o">.</span><span class="n">vertex_neighbor_vertices</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">nix_1</span><span class="p">:</span><span class="n">nix_2</span><span class="p">]</span></code></pre></figure>

<p>The above function is a simple wrapper to return the indices of neighbors in the points list originally used to make the <code class="highlighter-rouge">triang</code> object - the function’s second argument. There are many options for selecting neighboring particles to calculate <span>​<script type="math/tex"> \psi_6 </script></span>. <label for="Mickel-cite" class="margin-toggle sidenote-number"></label><input type="checkbox" id="Mickel-cite" class="margin-toggle" /><span class="sidenote">W. Mickel, et al., <em>Shortcomings of the Bond Orientational Order Parameters for the Analysis of Disordered Particulate Matter</em>, J. Chem. Phys. 138, 044501 (2013) <cite><a href="http://arxiv.org/abs/1209.6180">arXiv 1209.6180</a></cite> </span></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">psi6</span><span class="p">(</span><span class="n">points</span><span class="p">,</span><span class="n">polar</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="s">"""
    Return the 2D psi6 order parameter by finding the
    neighboring particles based on a delaunay triangulation.
    Works with holey data (NaNs).
    See Halperin and Nelson: Theory of Two-Dimensional Melting
    http://journals.aps.org/prl/abstract/10.1103/PhysRevLett.41.121
    Input
    -----
    points : 2D numpy array, N points by D dimensions
    polar : option to return psi6 in polar coordinates,
            i.e. [|psi6|,j*phase]
    Returns
    -------
    numpy 1d array of N values of psi6 for each point in input array
    OR numpy 2d array of N x 2 value pairs of [|psi6|,j*phase]

    Note
    -----
    - compute average of np.abs(result) to find system psi6
    - Thanks Matt Gratale for the polar coordinates option.

    todo : 3d
    """</span>
    <span class="n">not_nan_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">points</span><span class="p">))[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">psi6s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="nb">complex</span><span class="p">)</span>
    <span class="n">psi6s</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">pol6</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">),</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">pol6</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">not_nan_points</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">not_nan_indices</span><span class="p">]</span>
    <span class="n">tri</span> <span class="o">=</span> <span class="n">Delaunay</span><span class="p">(</span><span class="n">not_nan_points</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">pi</span><span class="p">,</span><span class="n">nni</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">not_nan_points</span><span class="p">)),</span>
                      <span class="n">not_nan_indices</span><span class="p">):</span>
        <span class="n">neighs</span> <span class="o">=</span> <span class="n">find_neighbors</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span><span class="n">tri</span><span class="p">)</span>
        <span class="n">vecs</span> <span class="o">=</span> <span class="n">not_nan_points</span><span class="p">[</span><span class="n">neighs</span><span class="p">]</span><span class="o">-</span><span class="n">not_nan_points</span><span class="p">[</span><span class="n">pi</span><span class="p">]</span>
        <span class="c">#angs = np.arctan2(vecs[:,1],vecs[:,0])</span>
        <span class="n">angs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">vecs</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">vecs</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">psi6s</span><span class="p">[</span><span class="n">nni</span><span class="p">]</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">6.0</span><span class="n">j</span><span class="o">*</span><span class="n">angs</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">polar</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">pol6</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">psi6s</span><span class="p">)</span>
        <span class="n">pol6</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">psi6s</span><span class="o">.</span><span class="n">imag</span><span class="o">/</span><span class="n">psi6s</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>            
        <span class="k">return</span> <span class="n">pol6</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">psi6s</span></code></pre></figure>

<p>Let’s check the results of the above function by plotting the values for each particle in a soft colloidal packing.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
 <span class="c">#just loading some data</span>
<span class="n">xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">'/Users/zoeydavidson/Desktop/colloids_frame.npy'</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">xy</span><span class="o">.</span><span class="n">shape</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>(3196, 2)
</code></pre>
</div>

<p>Below I show a typical bidisperse packing with area fraction approximately 0.84 and and a ratio of large/small particles about 1.25. There are many polycrystalline domains.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">xy_psi6</span> <span class="o">=</span> <span class="n">psi6</span><span class="p">(</span><span class="n">xy</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">'$</span><span class="err">\</span><span class="s">psi_6$'</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xy</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">xy</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">vmin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
            <span class="n">c</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">xy_psi6</span><span class="p">),</span><span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">xy</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">xy</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">xy</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">xy</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">cb</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s">'$</span><span class="err">\</span><span class="s">psi_6$'</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s">'x'</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s">'both'</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s">'major'</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span></code></pre></figure>

<p><img src="/images/psi-6-2015-01-11_files/psi-6-2015-01-11_8_0.png" alt="png" /></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">print</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">xy_psi6</span><span class="p">)),</span><span class="mi">3</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>0.756
</code></pre>
</div>


    </article>
    <span class="print-footer">Orientational Bond order	parameter - January 14, 2016 - Zoey S. Davidson</span>
    <footer>
  <hr class="slender">
  <ul class="footer-links">
    <li><a href="mailto:zoeith_@_zoeith.com"><span class="icon-mail"></span></a></li>    
    
      <li>
        <a href="//scholar.google.com/citations?hl=en&user=tu9XJuEAAAAJ"><span class="icon-google-scholar"></span></a>
      </li>
    
      <li>
        <a href="//www.twitter.com/zoeith"><span class="icon-twitter"></span></a>
      </li>
    
      <li>
        <a href="//github.com/zoeith"><span class="icon-github"></span></a>
      </li>
    
      <li>
        <a href="/feed.xml"><span class="icon-feed"></span></a>
      </li>
      
  </ul>
<div class="credits">
<span> ZOEY S. DAVIDSON &nbsp;&vert;&nbsp; 2016</span></br> <br>
<span>This site created with the <a href="//github.com/clayh53/tufte-jekyll">Tufte theme </a> in <a href="//jekyllrb.com">Jekyll</a>.</span> 
</div>  
</footer>

  </body>
</html>
